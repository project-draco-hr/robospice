{
  PausableThreadPoolExecutor executorService=PriorityThreadPoolExecutor.getPriorityExecutor(1);
  networkStateChecker=new MockNetworkStateChecker();
  requestProcessorUnderTest=new RequestProcessor(getContext(),mockCacheManager,executorService,requestProcessorListener,networkStateChecker,progressReporter,spiceServiceListenerNotifier);
  EasyMock.expect(mockCacheManager.loadDataFromCache(EasyMock.eq(TEST_CLASS),EasyMock.eq(TEST_CACHE_KEY),EasyMock.eq(TEST_DURATION))).andReturn(null);
  EasyMock.expectLastCall().anyTimes();
  EasyMock.expect(mockCacheManager.saveDataToCacheAndReturnData(EasyMock.eq(TEST_RETURNED_DATA),EasyMock.eq(TEST_CACHE_KEY))).andReturn(TEST_RETURNED_DATA);
  EasyMock.expectLastCall().anyTimes();
  EasyMock.replay(mockCacheManager);
  CachedSpiceRequestStub<String> spiceRequestStub=createSuccessfulRequest(TEST_CLASS,TEST_CACHE_KEY,TEST_DURATION,TEST_RETURNED_DATA,WAIT_BEFORE_REQUEST_EXECUTION);
  spiceRequestStub.setPriority(SpiceRequest.PRIORITY_LOW);
  spiceRequestStub.setRetryPolicy(null);
  CachedSpiceRequestStub<String> spiceRequestStub2=createSuccessfulRequest(TEST_CLASS,TEST_CACHE_KEY,TEST_DURATION,TEST_RETURNED_DATA,WAIT_BEFORE_REQUEST_EXECUTION);
  spiceRequestStub2.setPriority(SpiceRequest.PRIORITY_HIGH);
  spiceRequestStub2.setRetryPolicy(null);
  RequestListenerWithProgressStub<String> mockRequestListener=new RequestListenerWithProgressStub<String>();
  Set<RequestListener<?>> requestListenerSet=new HashSet<RequestListener<?>>();
  requestListenerSet.add(mockRequestListener);
  RequestListenerWithProgressStub<String> mockRequestListener2=new RequestListenerWithProgressStub<String>();
  Set<RequestListener<?>> requestListenerSet2=new HashSet<RequestListener<?>>();
  requestListenerSet2.add(mockRequestListener2);
  SpiceServiceListener listener1=EasyMock.createMock(SpiceServiceListener.class);
  listener1.onRequestAdded((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  listener1.onRequestAggregated((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  listener1.onRequestProgressUpdated((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  EasyMock.expectLastCall().anyTimes();
  listener1.onRequestProcessed((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  EasyMock.expectLastCall().anyTimes();
  listener1.onRequestSucceeded((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  EasyMock.replay(listener1);
  SpiceServiceListener listener2=EasyMock.createMock(SpiceServiceListener.class);
  listener2.onRequestAdded((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  listener2.onRequestAggregated((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  listener2.onRequestProgressUpdated((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  EasyMock.expectLastCall().anyTimes();
  listener2.onRequestProcessed((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  EasyMock.expectLastCall().anyTimes();
  listener2.onRequestSucceeded((CachedSpiceRequest<?>)EasyMock.anyObject(),(RequestProcessingContext)EasyMock.anyObject());
  EasyMock.replay(listener2);
  requestProcessorUnderTest.addSpiceServiceListener(listener1);
  requestProcessorUnderTest.addSpiceServiceListener(listener2);
  requestProcessorUnderTest.addRequest(spiceRequestStub,requestListenerSet);
  requestProcessorUnderTest.addRequest(spiceRequestStub2,requestListenerSet2);
  mockRequestListener.awaitComplete(REQUEST_COMPLETION_TIME_OUT);
  mockRequestListener.await(REQUEST_COMPLETION_TIME_OUT);
  mockRequestListener2.awaitComplete(REQUEST_COMPLETION_TIME_OUT);
  mockRequestListener2.await(REQUEST_COMPLETION_TIME_OUT);
  assertTrue(mockRequestListener.isComplete());
  assertTrue(mockRequestListener2.isComplete());
  assertTrue(mockRequestListener.isSuccessful());
  assertTrue(mockRequestListener2.isSuccessful());
  EasyMock.verify(listener1);
  EasyMock.verify(listener2);
}
